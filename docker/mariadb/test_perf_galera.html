<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tester Galera - Rapport de Performance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap');
        body { font-family: 'Outfit', sans-serif; background-color: #0f172a; color: #f1f5f9; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="p-8">
    <div class="max-w-6xl mx-auto space-y-8">
        <header class="glass p-8 rounded-3xl flex justify-between items-center">
            <div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent italic">
                    <i class="fa-solid fa-bolt-lightning mr-3"></i>Tester Galera
                </h1>
                <p class="text-slate-400 mt-2 font-light italic">Audit de performance du cluster Galera via HAProxy</p>
            </div>
            <div class="text-right">
                <span class="px-4 py-1 rounded-full bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 text-sm font-semibold mb-2 block lowercase">Profil: standard</span>
                <span class="text-slate-500 text-xs font-mono">Fri Jan  2 23:22:07 CET 2026</span>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <!-- KPIs -->
            <div class="glass p-6 rounded-2xl">
                <div class="text-slate-500 text-xs uppercase font-bold mb-2">Throughput</div>
                <div class="text-3xl font-bold text-cyan-400">270.64 <span class="text-xs font-normal">tps</span></div>
            </div>
            <div class="glass p-6 rounded-2xl">
                <div class="text-slate-500 text-xs uppercase font-bold mb-2">Query Load</div>
                <div class="text-3xl font-bold text-blue-400">5484.85 <span class="text-xs font-normal">qps</span></div>
            </div>
            <div class="glass p-6 rounded-2xl">
                <div class="text-slate-500 text-xs uppercase font-bold mb-2">Avg Latency</div>
                <div class="text-3xl font-bold text-purple-400">14.77 <span class="text-xs font-normal text-slate-500 uppercase">ms</span></div>
            </div>
            <div class="glass p-6 rounded-2xl border-l-4 border-rose-500/50">
                <div class="text-slate-500 text-xs uppercase font-bold mb-2">Ignored Errors</div>
                <div class="text-3xl font-bold text-rose-400">266</div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Query Metrics -->
            <div class="glass p-8 rounded-3xl">
                <h3 class="text-xl font-bold mb-6 flex items-center text-blue-400">
                    <i class="fa-solid fa-magnifying-glass-chart mr-3"></i>Query Metrics
                </h3>
                <div class="space-y-6">
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-slate-400 font-semibold uppercase text-xs tracking-wider">READ Queries</span>
                            <span class="text-blue-400 font-bold">231112</span>
                        </div>
                        <div class="w-full bg-slate-800 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full shadow-[0_0_10px_rgba(59,130,246,0.5)]" style="width: 70.21%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-slate-400 font-semibold uppercase text-xs tracking-wider">WRITE Queries</span>
                            <span class="text-cyan-400 font-bold">51795</span>
                        </div>
                        <div class="w-full bg-slate-800 rounded-full h-2">
                            <div class="bg-cyan-500 h-2 rounded-full shadow-[0_0_10px_rgba(34,211,238,0.5)]" style="width: 15.73%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-slate-400 font-semibold uppercase text-xs tracking-wider">OTHER Queries</span>
                            <span class="text-purple-400 font-bold">46262</span>
                        </div>
                        <div class="w-full bg-slate-800 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full shadow-[0_0_10px_rgba(168,85,247,0.5)]" style="width: 14.05%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Latency Profile -->
            <div class="glass p-8 rounded-3xl">
                <h3 class="text-xl font-bold mb-6 flex items-center text-cyan-400"><i class="fa-solid fa-chart-line mr-3"></i>Latency Profile (ms)</h3>
                <div class="h-64"><canvas id="latencyChart"></canvas></div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass p-8 rounded-3xl">
                <h3 class="text-xl font-bold mb-6 flex items-center text-amber-400"><i class="fa-solid fa-brain mr-3"></i>Conflict Intelligence</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 bg-amber-500/5 rounded-2xl border border-amber-500/10">
                        <div class="text-slate-500 text-[10px] uppercase font-bold mb-1">Cert. Failures</div>
                        <div class="text-2xl font-bold text-amber-400">7</div>
                    </div>
                    <div class="p-4 bg-orange-500/5 rounded-2xl border border-orange-500/10">
                        <div class="text-slate-500 text-[10px] uppercase font-bold mb-1">BF Aborts</div>
                        <div class="text-2xl font-bold text-orange-400">21</div>
                    </div>
                </div>
                <p class="mt-4 text-[10px] text-slate-400 italic">Deltas mesur√©s sur l'ensemble du cluster pendant le test.</p>
            </div>

            <div class="glass p-8 rounded-3xl">
                <h3 class="text-xl font-bold mb-6 flex items-center text-rose-400"><i class="fa-solid fa-shield-virus mr-3"></i>Cluster Logs Health</h3>
                <div class="p-4 bg-black/40 rounded-xl border border-rose-500/20 h-48 overflow-y-auto">
                    <pre class="text-[10px] text-rose-300/80 font-mono italic whitespace-pre-wrap">
--- mariadb-galera_01-1 ---
   THD: 2, mode: high priority, state: exec, conflict: executing, seqno: 54737
   THD: 2, mode: high priority, state: exec, conflict: executing, seqno: 56829
   THD: 2, mode: high priority, state: exec, conflict: executing, seqno: 57481
   THD: 22, mode: local, state: result, conflict: executing, seqno: -1
   THD: 23, mode: local, state: idle, conflict: executing, seqno: -1
2026-01-02 22:21:57 2 [Note] WSREP: cluster conflict due to high priority abort for threads:
2026-01-02 22:21:59 2 [Note] WSREP: UP-UP trx conflict for key (2,FLAT8)46e2732b 5b204972: source: 70ba7062-e7c8-11f0-81dc-074ec3f0478d version: 6 local: 0 flags: 65 conn_id: 13 trx_id: 116240 tstamp: 9612745267732; state:  seqnos (l: 16612, g: 57575, s: 57572, d: 57482) WS pa_range: 65535; state history: REPLICATING:0->CERTIFYING:3281 <---> source: 4dd686a3-e7c8-11f0-8539-5f5071f0d2dd version: 6 local: 1 flags: 65 conn_id: 22 trx_id: 290520 tstamp: 9612743926935; state:  seqnos (l: 16611, g: 57574, s: 57572, d: 57482) WS pa_range: 92; state history: REPLICATING:0->CERTIFYING:3281->APPLYING:1022->COMMITTING:1273->COMMITTED:1447
2026-01-02 22:21:59 2 [Note] WSREP: cluster conflict due to high priority abort for threads:
2026-01-02 22:22:00 2 [Note] WSREP: EX-UP trx conflict for key (3,FLAT8)0727bd7d 357df416: source: 70ba7062-e7c8-11f0-81dc-074ec3f0478d version: 6 local: 0 flags: 65 conn_id: 13 trx_id: 116483 tstamp: 9612886371207; state:  seqnos (l: 16645, g: 57608, s: 57606, d: 57482) WS pa_range: 65535; state history: REPLICATING:0->CERTIFYING:3281 <---> source: 4dd686a3-e7c8-11f0-8539-5f5071f0d2dd version: 6 local: 1 flags: 65 conn_id: 23 trx_id: 291071 tstamp: 9612886051175; state:  seqnos (l: 16644, g: 57607, s: 57605, d: 57482) WS pa_range: 125; state history: REPLICATING:0->CERTIFYING:3281->APPLYING:1022->COMMITTING:1273->COMMITTED:1447

--- mariadb-galera_02-1 ---
   THD: 13, mode: local, state: exec, conflict: certifying, seqno: -1
   THD: 13, mode: local, state: exec, conflict: certifying, seqno: 57608
   THD: 13, mode: local, state: idle, conflict: executing, seqno: -1
   THD: 2, mode: high priority, state: exec, conflict: executing, seqno: 57574
   THD: 2, mode: high priority, state: exec, conflict: executing, seqno: 57607
   THD: 2, mode: high priority, state: exec, conflict: executing, seqno: 58651
2026-01-02 22:21:59 13 [Note] WSREP: UP-UP trx conflict for key (2,FLAT8)46e2732b 5b204972: source: 70ba7062-e7c8-11f0-81dc-074ec3f0478d version: 6 local: 1 flags: 65 conn_id: 13 trx_id: 116240 tstamp: 9612745267732; state:  seqnos (l: 16608, g: 57575, s: 57572, d: 57482) WS pa_range: 65535; state history: REPLICATING:0->CERTIFYING:3281 <---> source: 4dd686a3-e7c8-11f0-8539-5f5071f0d2dd version: 6 local: 0 flags: 65 conn_id: 22 trx_id: 290520 tstamp: 9612743926935; state:  seqnos (l: 16607, g: 57574, s: 57572, d: 57482) WS pa_range: 92; state history: REPLICATING:0->CERTIFYING:3281->APPLYING:495
2026-01-02 22:22:00 13 [Note] WSREP: EX-UP trx conflict for key (3,FLAT8)0727bd7d 357df416: source: 70ba7062-e7c8-11f0-81dc-074ec3f0478d version: 6 local: 1 flags: 65 conn_id: 13 trx_id: 116483 tstamp: 9612886371207; state:  seqnos (l: 16641, g: 57608, s: 57606, d: 57482) WS pa_range: 65535; state history: REPLICATING:0->CERTIFYING:3281 <---> source: 4dd686a3-e7c8-11f0-8539-5f5071f0d2dd version: 6 local: 0 flags: 65 conn_id: 23 trx_id: 291071 tstamp: 9612886051175; state:  seqnos (l: 16640, g: 57607, s: 57605, d: 57482) WS pa_range: 125; state history: REPLICATING:0->CERTIFYING:3281->APPLYING:495
2026-01-02 22:22:00 2 [Note] WSREP: cluster conflict due to high priority abort for threads:
2026-01-02 22:22:03 2 [Note] WSREP: cluster conflict due to high priority abort for threads:

--- mariadb-galera_03-1 ---
No relevant issues found.
</pre>
                </div>
            </div>
        </div>

        <details class="glass p-6 rounded-2xl text-slate-500">
            <summary class="cursor-pointer font-bold uppercase text-xs">Raw sysbench output</summary>
            <pre class="mt-4 p-4 bg-black/40 rounded text-[10px] font-mono whitespace-pre overflow-x-auto">sysbench 1.0.20 (using system LuaJIT 2.1.0-beta3)

Running the test with following options:
Number of threads: 4
Report intermediate results every 10 second(s)
Initializing random number generator from current time


Initializing worker threads...

Threads started!

[ 10s ] thds: 4 tps: 274.96 qps: 5576.95 (r/w/o: 3916.50/695.79/964.65) lat (ms,95%): 19.65 err/s: 4.50 reconn/s: 0.00
[ 20s ] thds: 4 tps: 273.01 qps: 5511.15 (r/w/o: 3864.90/889.12/757.12) lat (ms,95%): 19.29 err/s: 3.10 reconn/s: 0.00
[ 30s ] thds: 4 tps: 265.60 qps: 5389.33 (r/w/o: 3785.15/884.39/719.79) lat (ms,95%): 19.65 err/s: 4.80 reconn/s: 0.00
[ 40s ] thds: 4 tps: 253.39 qps: 5154.17 (r/w/o: 3621.94/844.66/687.57) lat (ms,95%): 20.00 err/s: 5.30 reconn/s: 0.00
[ 50s ] thds: 4 tps: 278.22 qps: 5632.74 (r/w/o: 3954.44/929.06/749.25) lat (ms,95%): 18.95 err/s: 4.20 reconn/s: 0.00
[ 60s ] thds: 4 tps: 278.70 qps: 5649.42 (r/w/o: 3966.45/935.59/747.39) lat (ms,95%): 17.95 err/s: 4.70 reconn/s: 0.00
SQL statistics:
    queries performed:
        read:                            231112
        write:                           51795
        other:                           46262
        total:                           329169
    transactions:                        16242  (270.64 per sec.)
    queries:                             329169 (5484.85 per sec.)
    ignored errors:                      266    (4.43 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          60.0131s
    total number of events:              16242

Latency (ms):
         min:                                   11.06
         avg:                                   14.77
         max:                                  541.90
         95th percentile:                       19.29
         sum:                               239958.19

Threads fairness:
    events (avg/stddev):           4060.5000/22.60
    execution time (avg/stddev):   59.9895/0.00
</pre>
        </details>
    </div>
    <script>
        new Chart(document.getElementById('latencyChart'), {
            type: 'bar',
            data: {
                labels: ['Min', 'Avg', '95th', 'Max'],
                datasets: [{
                    label: 'Latency (ms)',
                    data: [11.06, 14.77, 19.29, 541.90],
                    backgroundColor: 'rgba(34, 211, 238, 0.2)',
                    borderColor: '#22d3ee',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, ticks: { callback: function(value) { return value + ' ms'; } } }
                }
            }
        });
    </script>
</body>
</html>

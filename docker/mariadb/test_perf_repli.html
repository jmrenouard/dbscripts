<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tester Replication - Rapport de Performance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap');
        body { font-family: 'Outfit', sans-serif; background-color: #0f172a; color: #f1f5f9; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="p-8">
    <div class="max-w-6xl mx-auto space-y-8">
        <header class="glass p-8 rounded-3xl flex justify-between items-center">
            <div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-emerald-400 to-teal-500 bg-clip-text text-transparent italic">
                    <i class="fa-solid fa-link mr-3"></i>Tester Replication
                </h1>
                <p class="text-slate-400 mt-2 font-light italic">Audit de performance MariaDB Master/Slave via HAProxy</p>
            </div>
            <div class="text-right">
                <span class="px-4 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 text-sm font-semibold mb-2 block lowercase">Profil: light</span>
                <span class="text-slate-500 text-xs font-mono">Fri Jan  2 23:10:17 CET 2026</span>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <!-- KPIs -->
            <div class="glass p-6 rounded-2xl">
                <div class="text-slate-500 text-xs uppercase font-bold mb-2">Throughput</div>
                <div class="text-3xl font-bold text-emerald-400">156.97 <span class="text-xs font-normal">tps</span></div>
            </div>
            <div class="glass p-6 rounded-2xl">
                <div class="text-slate-500 text-xs uppercase font-bold mb-2">Query Load</div>
                <div class="text-3xl font-bold text-teal-400">5912.45 <span class="text-xs font-normal">qps</span></div>
            </div>
            <div class="glass p-6 rounded-2xl">
                <div class="text-slate-500 text-xs uppercase font-bold mb-2">Avg Latency</div>
                <div class="text-3xl font-bold text-blue-400">25.44 <span class="text-xs font-normal text-slate-500 uppercase">ms</span></div>
            </div>
            <div class="glass p-6 rounded-2xl">
                <div class="text-slate-500 text-xs uppercase font-bold mb-2">Slave Lag</div>
                <div class="text-3xl font-bold text-amber-400">0 <span class="text-xs font-normal text-slate-500">sec</span></div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Query Metrics -->
            <div class="glass p-8 rounded-3xl">
                <h3 class="text-xl font-bold mb-6 flex items-center text-teal-400">
                    <i class="fa-solid fa-magnifying-glass-chart mr-3"></i>Query Metrics
                </h3>
                <div class="space-y-6">
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-slate-400 font-semibold uppercase text-xs tracking-wider">READ Queries</span>
                            <span class="text-emerald-400 font-bold">46662</span>
                        </div>
                        <div class="w-full bg-slate-800 rounded-full h-2">
                            <div class="bg-emerald-500 h-2 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]" style="width: 78.70%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-slate-400 font-semibold uppercase text-xs tracking-wider">WRITE Queries</span>
                            <span class="text-teal-400 font-bold">7716</span>
                        </div>
                        <div class="w-full bg-slate-800 rounded-full h-2">
                            <div class="bg-teal-500 h-2 rounded-full shadow-[0_0_10px_rgba(20,184,166,0.5)]" style="width: 13.01%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-slate-400 font-semibold uppercase text-xs tracking-wider">OTHER Queries</span>
                            <span class="text-blue-400 font-bold">4907</span>
                        </div>
                        <div class="w-full bg-slate-800 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full shadow-[0_0_10px_rgba(59,130,246,0.5)]" style="width: 8.27%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Latency Profile -->
            <div class="glass p-8 rounded-3xl">
                <h3 class="text-xl font-bold mb-6 flex items-center text-teal-400"><i class="fa-solid fa-chart-line mr-3"></i>Latency Profile (ms)</h3>
                <div class="h-64"><canvas id="latencyChart"></canvas></div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass p-8 rounded-3xl">
                <h3 class="text-xl font-bold mb-6 flex items-center text-emerald-400"><i class="fa-solid fa-hourglass-half mr-3"></i>Replication Intelligence</h3>
                <div class="p-6 bg-emerald-500/5 rounded-2xl border border-emerald-500/10 flex justify-between items-center">
                    <div>
                        <div class="text-slate-500 text-[10px] uppercase font-bold mb-1">Max Slave Lag</div>
                        <div class="text-3xl font-bold text-emerald-400">0 <span class="text-xs font-normal">s</span></div>
                    </div>
                </div>
                <p class="mt-4 text-[10px] text-slate-400 italic">Retard maximal constaté sur les esclaves après le test.</p>
            </div>

            <div class="glass p-8 rounded-3xl">
                <h3 class="text-xl font-bold mb-6 flex items-center text-rose-400"><i class="fa-solid fa-shield-virus mr-3"></i>Cluster Logs Health</h3>
                <div class="p-4 bg-black/40 rounded-xl border border-rose-500/20 h-48 overflow-y-auto">
                    <pre class="text-[10px] text-rose-300/80 font-mono italic whitespace-pre-wrap">
--- mariadb-mariadb_01-1 ---
No relevant issues found.

--- mariadb-mariadb_02-1 ---
No relevant issues found.

--- mariadb-mariadb_03-1 ---
No relevant issues found.
</pre>
                </div>
            </div>
        </div>

        <details class="glass p-6 rounded-2xl text-slate-500">
            <summary class="cursor-pointer font-bold uppercase text-xs">Raw sysbench output</summary>
            <pre class="mt-4 p-4 bg-black/40 rounded text-[10px] font-mono whitespace-pre overflow-x-auto">sysbench 1.0.20 (using system LuaJIT 2.1.0-beta3)

Running the test with following options:
Number of threads: 4
Report intermediate results every 10 second(s)
Initializing random number generator from current time


Initializing worker threads...

Threads started!

[ 10s ] thds: 4 tps: 156.98 qps: 5921.04 (r/w/o: 4661.23/769.69/490.13) lat (ms,95%): 64.47 err/s: 175.77 reconn/s: 0.00
SQL statistics:
    queries performed:
        read:                            46662
        write:                           7716
        other:                           4907
        total:                           59285
    transactions:                        1574   (156.97 per sec.)
    queries:                             59285  (5912.45 per sec.)
    ignored errors:                      1759   (175.42 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          10.0261s
    total number of events:              1574

Latency (ms):
         min:                                   10.63
         avg:                                   25.44
         max:                                  146.65
         95th percentile:                       64.47
         sum:                                40046.58

Threads fairness:
    events (avg/stddev):           393.5000/10.43
    execution time (avg/stddev):   10.0116/0.01
</pre>
        </details>
    </div>
    <script>
        new Chart(document.getElementById('latencyChart'), {
            type: 'bar',
            data: {
                labels: ['Min', 'Avg', '95th', 'Max'],
                datasets: [{
                    label: 'Latency (ms)',
                    data: [10.63, 25.44, 64.47, 146.65],
                    backgroundColor: 'rgba(16, 185, 129, 0.2)',
                    borderColor: '#10b981',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, ticks: { callback: function(value) { return value + ' ms'; } } }
                }
            }
        });
    </script>
</body>
</html>
